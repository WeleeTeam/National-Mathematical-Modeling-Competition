# 问题4技术分析总结报告：女胎异常判定方法

## 1. 问题背景

由于孕妇和女胎都不携带Y染色体，需要基于其他指标判定女胎是否异常。本研究以21号、18号和13号染色体非整倍体(AB列)为判定结果，综合考虑X染色体及上述染色体的Z值、GC含量、读段数及相关比例、BMI等因素，构建女胎异常的判定方法。

## 2. 数据概况

- **总样本数**: 605个女胎检测样本
- **有效样本数**: 604个（清理后）
- **异常样本**: 67个（11.1%）
- **正常样本**: 537个（88.9%）
- **特征维度**: 13个关键特征

## 3. 五步法特征筛选

### 3.1 步骤1：分组处理
根据BMI值将孕妇分成5个亚组，控制混杂因素：
- [20,28): 5个样本（异常比例40%）
- [28,32): 338个样本（异常比例11.5%）
- [32,36): 194个样本（异常比例12.4%）
- [36,40): 54个样本（异常比例3.7%）
- ≥40: 13个样本（异常比例0%）

### 3.2 步骤2：相关性计算
使用Spearman相关系数分析各特征与异常判定结果的相关性：
- 公式：r = 1 - (6 * Σd²) / (n * (n² - 1))
- 在3个有效BMI组内分别计算相关系数
- 发现手动计算与Scipy结果存在差异，需要进一步验证

### 3.3 步骤3：质量控制
应用严格的质量控制标准：
- 总样本数 ≥ 10
- 异常样本数 ≥ 2
- 正常样本数 ≥ 2
- 最终保留3个有效组：28-32、32-36、36-40

### 3.4 步骤4：多维度评估
按照科学方案计算三个维度得分：

**关联强度 (S1_i)**: 平均相关系数的绝对值
- 最高：孕妇BMI (0.151)
- 次高：18号染色体的Z值 (0.121)

**统计显著性 (S2_i)**: 显著相关组数比例
- 最高：孕妇BMI (0.667，2/3组显著)
- 次高：18号染色体的Z值、重复读段的比例 (0.333，1/3组显著)

**跨组一致性 (S3_i)**: 强相关组数比例
- 多个特征达到0.333（1/3组强相关）

### 3.5 步骤5：综合评分
使用公式：S_i = S1_i + 0.3 * S2_i + 0.2 * S3_i

**最终特征重要性排名**：
1. 孕妇BMI (0.418)
2. 18号染色体的Z值 (0.287)
3. 重复读段的比例 (0.274)
4. 13号染色体的Z值 (0.162)
5. 原始读段数 (0.158)
6. 唯一比对的读段数 (0.156)
7. 体重 (0.078)
8. GC含量 (0.058)
9. 年龄 (0.056)

## 4. 深度神经网络建模

### 4.1 模型架构
- **网络结构**: 五层深度网络 (512, 256, 128, 64, 32)
- **激活函数**: ReLU
- **优化器**: Adam
- **正则化参数**: 5e-05
- **批次大小**: 16
- **最大迭代次数**: 5000

### 4.2 训练策略
- **代价敏感学习**: 自动计算类别权重 {0: 0.5625, 1: 4.5}
- **早停机制**: 验证集比例15%，耐心值200
- **学习率**: 自适应调整，初始值0.0005
- **收敛情况**: 实际迭代202次，模型已收敛

### 4.3 性能评估
- **AUC**: 0.632
- **交叉验证**: 0.587 ± 0.043
- **最优阈值**: 0.146（基于F1分数优化）
- **精确率**: 0.93（正常样本），0.21（异常样本）
- **召回率**: 0.74（正常样本），0.54（异常样本）
- **F1分数**: 0.83（正常样本），0.30（异常样本）
- **总体准确率**: 72%

## 5. 关键发现

### 5.1 重要特征识别
1. **孕妇BMI**是最重要的预测因子，在多个BMI组中均显示显著相关性
2. **18号染色体的Z值**具有较高的关联强度和统计显著性
3. **重复读段的比例**在特定BMI组中显示强相关性
4. **染色体Z值**整体上比测序质量指标更重要

### 5.2 模型性能分析
- 模型在识别正常样本方面表现良好（精确率93%）
- 对异常样本的识别能力有限（精确率21%）
- 召回率显示模型能够捕获54%的异常样本
- 整体AUC为0.632，表明模型具有一定的判别能力

### 5.3 技术优势
1. **科学性强**: 使用五步法进行系统化特征筛选
2. **控制混杂**: 通过BMI分组控制混杂因素
3. **多维度评估**: 综合考虑关联强度、统计显著性和跨组一致性
4. **代价敏感**: 针对医学检测的不平衡数据特点优化

## 6. 局限性分析

### 6.1 数据限制
- 异常样本比例较低（11.1%），影响模型学习
- 部分BMI组样本量不足，影响统计推断
- 手动计算与Scipy结果存在差异，需要进一步验证

### 6.2 模型限制
- AUC为0.632，距离理想性能（>0.8）还有差距
- 对异常样本的精确率较低，可能存在误诊风险
- 模型复杂度较高，可能存在过拟合风险

## 7. 改进建议

### 7.1 数据层面
- 收集更多异常样本，平衡数据集
- 增加样本量，特别是高BMI组
- 验证Spearman相关系数计算的一致性

### 7.2 模型层面
- 尝试集成学习方法提升性能
- 优化网络架构和超参数
- 使用更先进的特征工程技术

### 7.3 评估层面
- 增加更多评估指标（如PR-AUC）
- 进行更严格的交叉验证
- 考虑临床实际应用场景的评估标准

## 8. 结论

本研究成功构建了基于五步法特征筛选和深度神经网络的女胎异常判定方法。孕妇BMI和18号染色体的Z值被识别为最重要的预测因子。虽然模型具有一定的判别能力（AUC=0.632），但在异常样本识别方面仍有改进空间。该方法为NIPT检测中的女胎异常判定提供了科学依据，但需要进一步优化以提升临床实用性。

## 9. 技术文件

- 源代码：`problem4_analysis.py`
- 结果文件：`problem4_analysis/results/`
- 特征排名：`feature_ranking.csv`
- 模型性能：`model_performance.csv`
- 可视化结果：`*.png`文件
